/*1365389804,173213215*/

if (self.CavalryLogger) { CavalryLogger.start_js(["yBK09"]); }

__d("Registration",["Animation","AsyncRequest","AsyncSignal","CSS","DataStore","DOM","Event","Form","HTML","JPPhoneCaptcha","Recaptcha","RegistrationInterstitialCaptcha","Style","$","ge","goURI"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('AsyncRequest'),i=b('AsyncSignal'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('Event'),n=b('Form'),o=b('HTML'),p=b('JPPhoneCaptcha'),q=b('Recaptcha'),r=b('RegistrationInterstitialCaptcha'),s=b('Style'),t=b('$'),u=b('ge'),v=b('goURI'),w='/ajax/register/logging.php',x={init:function(y,z,aa,ba,ca,da,ea){this.captchaPaneShown=false;this.errorField=null;this.hasLoggedFocused=false;this.regForm=y;this.logFocusName=aa;this.validationEndpoint=ba;this.responseCallback=this.handleResponse;this.tosContainerNode=u('tos_container');this.regPagesMsgNode=u('reg_pages_msg');this.captchaButtonsNode=u('captcha_buttons');this.initListeners(ca,da,ea);},initListeners:function(y,z,aa){m.listen(this.regForm,'focus',this.logFormFocus.bind(this));m.listen(y,'click',this.validateForm.bind(this));m.listen(z,'click',this.validateForm.bind(this));m.listen(aa,'click',(function(){this.hideCaptcha();this.showRegistrationPane();}).bind(this));m.listen(window,'load',(function(){a.startFormTypeABTester(this.regForm);m.listen(y,'click',a.setFormTypeABTest.bind(this,this.regForm));m.listen(z,'click',a.setFormTypeABTest.bind(this,this.regForm));}).bind(this));},validateForm:function(){var y=n.serialize(this.regForm);if(!this.captchaPaneShown)y.ignore='captcha|pc';if(this.errorField&&u(this.errorField))t(this.errorField).setAttribute('title','');j.show('async_status');j.show('captcha_async_status');new h().setOption('jsonp',true).setURI(this.validationEndpoint).setData(y).setReadOnly(true).setHandler(this.responseCallback.bind(this)).send();},handleResponse:function(y){j.hide('async_status');j.hide('captcha_async_status');var z=y.getPayload();if(z.redirect){j.show('captcha_async_status');v(z.redirect);}else if(z.field_validation_succeeded){this.handleFieldValidationSucceeded(z);}else if(z.bad_captcha){this.handleBadCaptcha(z);}else if(z.need_pc){this.handleNeedPC(z);}else if(z.tooyoung){this.handleTooYoung(z);}else if(z.ask_to_login_instead){var aa=u('email');if(aa)aa.value=z.ask_to_login_instead;var ba=u('asked_to_login');if(ba)ba.value=1;}else if(z.registration_succeeded){this.handleRegistrationSucceeded(z);}else this.handleValidationError(z);},handleValidationError:function(y){this.showValidationError(y.field,y.error);},handleRegistrationSucceeded:function(y){var z=t('confirmation_email_form'),aa=t('confirmation_email');aa.value=y.email;z.submit();},handleBadCaptcha:function(y){l.setContent(t('outer_captcha_box'),o(y.html));this.showCaptchaPane();this.showValidationError('captcha_response',y.error);},handleNeedPC:function(y){var z=u('outer_captcha_box');if(z)l.setContent(z,o(y.html));this.showCaptchaPane();this.showValidationError('pc',y.error);},handleFieldValidationSucceeded:function(y){this.hideValidationError();this.showCaptchaPane();if(y.show_captcha_interstitial)r.show();},handleTooYoung:function(y){l.setContent(this.regForm,o(y.html));},showCaptchaPane:function(){j.hide('reg_form_box');var y=t('captcha'),z=k.get(y,'captcha-class','FacebookCaptcha');if(z=='ReCaptchaCaptcha'){q.createCaptcha();}else if(z=='JPPhoneCaptcha')p.createCaptcha();j.show('reg_captcha');this.tosContainerNode&&j.show(this.tosContainerNode);this.regPagesMsgNode&&j.hide(this.regPagesMsgNode);this.captchaButtonsNode&&j.show(this.captchaButtonsNode);try{u('captcha_response').focus();}catch(aa){}this.captchaPaneShown=true;},hideCaptcha:function(){u('reg_captcha')&&j.hide('reg_captcha');this.tosContainerNode&&j.hide(this.tosContainerNode);this.captchaButtonsNode&&j.hide(this.captchaButtonsNode);this.hideValidationError();this.captchaPaneShown=false;},showValidationError:function(y,z){this.regPagesMsgNode&&j.hide(this.regPagesMsgNode);this.hideValidationError();var aa=t('reg_error'),ba=t('reg_error_inner');if(!y)y=u('name')?'name':'firstname';this.errorField=y;try{t(y).setAttribute('title',z.replace(/<.+?>/g,''));t(y).focus();}catch(ca){}l.setContent(ba,o(z));s.set(aa,'opacity',0);new g(aa).show().to('height','auto').duration(100).checkpoint().from('opacity',0).to('opacity',1).duration(400).go();},hideValidationError:function(){if(j.shown(t('reg_error'))&&s.getOpacity(t('reg_error'))>0)j.hide(t('reg_error'));},showRegistrationPane:function(){j.show('reg_form_box');this.regPagesMsgNode&&j.show(this.regPagesMsgNode);},logFormFocus:function(){if(this.hasLoggedFocused)return;this.logAction(this.logFocusName);this.hasLoggedFocused=true;},logAction:function(y){var z=u('reg_instance'),aa='';if(z)aa=z.value;var ba={action:y,reg_instance:aa};new i(w,ba).send();}};e.exports=x;});