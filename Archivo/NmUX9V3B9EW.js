/*1363101351,173217629*/

if (self.CavalryLogger) { CavalryLogger.start_js(["m9Vmx"]); }

__d("JPPhoneCaptcha",["AsyncRequest","AsyncSignal","CSS","Dialog","DOM","Event","Parent","$","ge","bind","copyProperties","emptyFunction","tx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('AsyncSignal'),i=b('CSS'),j=b('Dialog'),k=b('DOM'),l=b('Event'),m=b('Parent'),n=b('$'),o=b('ge'),p=b('bind'),q=b('copyProperties'),r=b('emptyFunction'),s=b('tx');function t(u,v,w,x,y){var z=function(){this._dom=n(u);this._hash=w;this._altCaptcha=y;var aa=o('A_btn_sign_up');aa&&i.hide(aa);var ba=k.find(this._dom,'img');ba.onerror=ba.onload=function(){if(ba.width==1&&ba.height==1)this.showAlternateCaptcha();}.bind(this);ba.src=v;l.listen(k.find(this._dom,'a.qr-skip-link'),'click',this.showAlternateCaptcha.bind(this));this.checkStatus.bind(this).defer(t.initialPoll);t._currentInstance=this;}.bind(this);if(t._overrideDelay){x=false;delete t._overrideDelay;}if(x){t._delayedCaptcha=z;}else z();}t.initialPoll=5000;t.pollInterval=2000;t.createCaptcha=function(){if(t._currentInstance){t._currentInstance._destroyed=true;t._overrideDelay=true;delete t._currentInstance;}if(t._delayedCaptcha){t._delayedCaptcha();delete t._delayedCaptcha;}};q(t.prototype,{checkStatus:function(){new g('/captcha/qr_async.php').setData({hash:this._hash}).setOption('suppressErrorHandlerWarning',true).setErrorHandler(r).setReadOnly(true).setMethod('GET').setHandler(function(u){var v=u.getPayload();if(this._destroyed)return;if(v===false){this.showAlternateCaptcha();}else if(v===true){new j().setTitle("Casi has terminado.").setBody("Pasa a la p\u00e1gina siguiente para completar el registro.").setButtons(j.CLOSE).setCloseHandler(p(this,this.proceedToNux)).show();this._destroyed=true;}}.bind(this)).setFinallyHandler(function(){!this._destroyed&&this.checkStatus.bind(this).defer(t.pollInterval);}.bind(this)).send();},proceedToNux:function(){var u=m.byTag(this._dom,'form'),v=k.scry(u,'#captcha_buttons input');if(v.length==1&&v[0].onclick){v[0].onclick();}else u.submit();this._destroyed=true;},showAlternateCaptcha:function(){t._alternateCaptchaShown=true;t._stupidGlobalFunction();k.setContent(this._dom,this._altCaptcha);this._destroyed=true;var u=o('A_btn_sign_up');u&&i.show(u);new h('/captcha/qr_async.php',{skip:true,hash:this._hash}).send();return false;}});e.exports=t;});